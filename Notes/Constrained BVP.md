# Constrained BVP

# 1 回顾AM的做法

* 1）生成一条无约束的初始轨迹
* 2）检测初始轨迹的边界条件，进行方向饱和轨迹可行性。
* 3）对每一段轨迹的边界条件进行方向饱和，并检测整段轨迹的可行性。一段不行就把边界条件除以2继续检查。
  * 这种做法在状态方向有问题（比如时间分配过长的打结现象）时会导致enforce无论如何都失败。
  * 可以尝试初始状态启发式给出（指向下一状态）。
* 4）进行交替优化
  * 求解一次无约束的bvp
  * 记录Dp*作为最优方向
  * 二分查找lambda来改变整条轨迹的状态，检测可行性

# 2 只考虑约束的BVP

TGK中处理BVP采样的思路是

* ```cpp
  bool BiasSampler::samplingOnce(int idx, StatePVA& rand_state)
  ```

  函数采样了位置和速度，并把加速度置零

* 随后是选择父节点，直接生成位置速度约束的轨迹，加速度由min snap决定

* 随后进行one shot连接，采样点的加速度仍然使用上一步中的。



# 3 kite中怎么做

同样，我们只启发式的采样位置和速度，将加速度和jerk让给minsnap。这样就可以得到初始unconstarined的轨迹。接下来由两种思路

* 对末端状态进行方向饱和，并以此二分调节时间。
* 对末端状态释放，调节时间自由生成（这样不同的时间会带来不同的末端加速度）
* 将末端加速度和jerk置0，对末端速度进行方向饱和（目前的策略）。



* 考虑采样一个batch，然后选择cost最小的一个？
* 考虑采样范围在哪里？